{% extends 'base.html.twig' %}

{% block title %}{{ 'menu.products'|trans }}{% endblock %}

{% block body %}
<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-4xl font-black tracking-wider uppercase">{{ 'menu.products'|trans }}</h1>
        {% if is_granted('ROLE_ADMIN') %}
            <a href="{{ path('app_product_new') }}" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Ajouter un produit
            </a>
        {% endif %}
    </div>

    {# Affichage des messages flash #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="bg-{{ label == 'success' ? 'green' : 'red' }}-500 text-white p-4 rounded-lg mb-4 shadow-lg">
                {{ message }}
            </div>
        {% endfor %}
    {% endfor %}

    {# {{ component('ProductSearch') }} #}

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        {% for product in products %}
            <div class="bg-gray-800 rounded-lg shadow-lg flex flex-col justify-between transform hover:scale-105 transition-transform duration-300 ease-in-out">
                <a href="{{ path('app_product_show', {'id': product.id}) }}" class="block">
                    {% set mainImage = product.images|first %}

                    {% if mainImage %}
                        <img src="{{ asset('uploads/images/' ~ mainImage.url) }}" alt="{{ product.name }}" class="w-full h-48 object-cover">
                    {% else %}
                        <div class="w-full h-48 bg-gray-700 flex items-center justify-center">
                            <span class="text-gray-500">Aucune image</span>
                        </div>
                    {% endif %}
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-white mb-2 truncate">{{ product.name }}</h3>
                        <p class="text-gray-400 text-sm mb-3 h-10 overflow-hidden">{{ product.description|striptags|slice(0, 50) }}...</p>
                        <div class="flex items-center justify-between">
                            <span class="font-black text-xl text-red-500">{{ product.price|number_format(2, ',', ' ') }} €</span>
                            <span class="text-sm font-semibold {{ product.stock > 0 ? 'text-green-400' : 'text-red-400' }}">
                                {{ product.stock > 0 ? 'En stock' : 'Rupture' }}
                            </span>
                        </div>
                    </div>
                </a>

                {# SECTION DU BAS : Actions #}
                <div class="p-4 bg-gray-900 border-t border-gray-700 ">
                    {% if product.stock > 0 %}
                        <a href="{{ path('cart_add', {'id': product.id}) }}" class="w-full text-center block bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200">
                            Ajouter au panier
                        </a>
                    {% else %}
                         <span class="w-full text-center block bg-gray-600 text-gray-400 font-bold py-2 px-4 rounded cursor-not-allowed">
                            Indisponible
                        </span>
                    {% endif %}

                    {% if is_granted('ROLE_ADMIN') %}
                        <div class="mt-3 flex justify-end gap-2">
                            <a href="{{ path('app_product_edit', {'id': product.id}) }}" class="text-sm font-medium text-blue-400 hover:text-blue-300 transition-colors">Modifier</a>
                            <span class="text-gray-600">|</span>
                            {{ include('product/_delete_form.html.twig', {product: product}) }}
                        </div>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div class="col-span-full text-center py-12 bg-gray-800 rounded-lg">
                <p class="text-xl text-gray-400">Aucun produit trouvé.</p>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
